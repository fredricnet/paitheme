{{/* Blog Card Shortcode - For blog page cards
  Parameters:
  - post: Path to blog post (e.g., "blog/5-strategies-to-optimize-cash-flow") - if provided, automatically retrieves title, description, image, category, and link from the post
  - title: Card title (optional if post is provided)
  - description: Card description (optional if post is provided)
  - image: Main image path (optional, overrides post image if provided)
  - category: Category badge text (optional, overrides post category if provided)
  - link: Link URL (optional if post is provided)
  - featured: Set to "true" for featured/large card (optional, can also come from post front matter)
  - size: Card size (default: "1", options: "1", "2", or "full")
       "1" = 1 column (1/3 width in 3-col grid)
       "2" = 2 columns (2/3 width in 3-col grid)
       "full" = full width (span all columns)
*/}}
{{- $postPath := .Get "post" -}}
{{- $post := "" -}}
{{- if $postPath -}}
  {{- $post = site.GetPage $postPath -}}
{{- end -}}

{{- /* Check if post is published - skip rendering if publish is false */ -}}
{{- $isPublished := true -}}
{{- if $post -}}
  {{- $publishParam := $post.Params.publish -}}
  {{- if isset $post.Params "publish" -}}
    {{- if or (eq $publishParam false) (eq $publishParam "false") -}}
      {{- $isPublished = false -}}
    {{- else -}}
      {{- $isPublished = true -}}
    {{- end -}}
  {{- end -}}
{{- end -}}

{{- /* Only render if published */ -}}
{{- if $isPublished -}}

{{- /* Get values from post front matter if post is provided, otherwise use provided parameters */ -}}
{{- $title := .Get "title" -}}
{{- if and $post (not $title) -}}
  {{- $title = $post.Title -}}
{{- end -}}

{{- $description := .Get "description" -}}
{{- if and $post (not $description) -}}
  {{- $description = $post.Description | default $post.Summary -}}
{{- end -}}

{{- $image := .Get "image" -}}
{{- if and $post (not $image) -}}
  {{- $image = $post.Params.image -}}
{{- end -}}

{{- $category := .Get "category" -}}
{{- if and $post (not $category) -}}
  {{- $category = $post.Params.category -}}
{{- end -}}

{{- $link := .Get "link" -}}
{{- if and $post (not $link) -}}
  {{- $link = $post.RelPermalink -}}
{{- end -}}

{{- $featured := .Get "featured" | default "false" -}}
{{- if and $post (eq $featured "false") -}}
  {{- if $post.Params.featured -}}
    {{- $featured = "true" -}}
  {{- end -}}
{{- end -}}

{{- $size := .Get "size" | default "1" -}}

<article class="blog-card{{ if eq $featured "true" }} blog-card-featured{{ else if eq $size "2" }} blog-card-large{{ else if eq $size "full" }} blog-card-full{{ end }}">
    <div class="blog-card-image">
        {{- if $image -}}
        <img src="{{ $image }}" alt="{{ $title }}" onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';" />
        <div class="blog-card-image-placeholder" style="display: none;">
            <p>{{ $title }}</p>
        </div>
        {{- else -}}
        <div class="blog-card-image-placeholder">
            <p>{{ $title }}</p>
        </div>
        {{- end -}}
    </div>
    <div class="blog-card-content">
        {{- if $category -}}
        {{- /* Get category icon and color from categories.yaml */ -}}
        {{- $categorySpec := index site.Data.categories.categories $category -}}
        {{- $fallback := site.Data.categories.fallback -}}
        {{- $categoryIcon := "tag" -}}
        {{- $categoryColor := "#3b82f6" -}}
        {{- $iconCount := 1 -}}
        {{- if $categorySpec -}}
          {{- $categoryIcon = $categorySpec.icon | default $fallback.icon -}}
          {{- $categoryColor = index $categorySpec "icon-color" | default (index $fallback "icon-color") -}}
          {{- $iconCount = index $categorySpec "icon-count" | default (index $fallback "icon-count") -}}
        {{- else -}}
          {{- $categoryIcon = $fallback.icon -}}
          {{- $categoryColor = index $fallback "icon-color" -}}
          {{- $iconCount = index $fallback "icon-count" -}}
        {{- end -}}
        {{- partial "tag-badge.html" (dict "text" $category "icon" $categoryIcon "count" $iconCount "color" $categoryColor "margin" "0") -}}
        {{- end -}}
        <h{{ if eq $featured "true" }}2{{ else }}3{{ end }} class="blog-card-title">
            <a href="{{ $link }}">{{ $title }}</a>
        </h{{ if eq $featured "true" }}2{{ else }}3{{ end }}>
        <p class="blog-card-description">{{ $description }}</p>
        <a href="{{ $link }}" class="blog-card-link">Read more<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="blog-card-link-icon"><path d="m9 18 6-6-6-6"></path></svg></a>
    </div>
</article>

{{- end -}}
